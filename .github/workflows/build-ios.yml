name: Build iOS XCFramework

on:
  push:
    branches: [ "main" ]
  pull_request:
    branches: [ "main" ]

jobs:
  build-ios:
    name: ğŸ§± Build XCFramework
    runs-on: macos-latest

    steps:
      - name: ğŸ“¦ Checkout repository
        uses: actions/checkout@v4

      - name: ğŸ§° Set up JDK 17
        uses: actions/setup-java@v4
        with:
          java-version: '17'
          distribution: 'temurin'

      - name: ğŸ§± Setup Gradle
        uses: gradle/actions/setup-gradle@v3

      - name: ğŸ§¹ Clean project
        run: |
          chmod +x gradlew
          ./gradlew clean

      - name: ğŸ—ï¸ Build XCFramework
        run: |
          chmod +x gradlew
          ./gradlew :shared:createXCFramework --stacktrace

           - name: ğŸ“¦ Package XCFramework
        run: |
          cd shared/build/XCFrameworks
          # Handle both possible output folder names
          if [ -d "releaseSharedKit" ]; then
            cd releaseSharedKit
          elif [ -d "release" ]; then
            cd release
          else
            echo "âŒ No XCFramework output found!"
            ls -R ..
            exit 1
          fi
          zip -r sharedKit_v${{ github.run_number }}.zip sharedKit.xcframework


      - name: ğŸš€ Upload XCFramework Artifact
        uses: actions/upload-artifact@v4
        with:
          name: sharedKit_xcframework
          path: shared/build/XCFrameworks/release/sharedKit.xcframework
